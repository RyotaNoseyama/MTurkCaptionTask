generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Participant {
  workerId   String   @id
  cond       Int?
  tz         String?
  consentAt  DateTime?

  submissions Submission[]
  scores      Score[]  @relation("ParticipantScores")
}

model Day {
  id       String   @id @default(cuid())
  idx      Int      @unique
  dateJst  DateTime
}

model Submission {
  id          String   @id @default(cuid())
  workerId    String
  dayIdx      Int
  captionA    String
  captionB    String
  rtMs        Int?
  submittedAt DateTime @default(now())

  participant Participant @relation(fields: [workerId], references: [workerId])
  score       Score?

  @@unique([workerId, dayIdx])
}

model Score {
  id            String   @id @default(cuid())
  submissionId  String   @unique
  workerId      String
  score         Int
  is7plus       Boolean  @default(false)
  scoredAt      DateTime @default(now())
  scorer        String?

  submission    Submission @relation(fields: [submissionId], references: [id])
  participant   Participant @relation("ParticipantScores", fields: [workerId], references: [workerId])
}
